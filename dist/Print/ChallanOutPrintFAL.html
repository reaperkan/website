<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/grids.css">
    <style>
      p{
        font-weight: 600;
      }
      *{
        margin: 0;
      }
      .table-body{
        height: 30mm;
        text-align: justify;
      }
      .firstPage{
        height: 137mm;
      }
      .secondPage{
        height: 240mm;
      }
      .content{
        margin-top: 2mm;
        margin-left: 2mm;
        height: 20mm;
        /* font-weight: lighter; */
        text-align: left;
        font-size: small;
        font-weight: 400;
      }
      .content p{
        text-align: left;
        font-size: small;
        font-weight: 400;
      } 
      .small-p{
        font-size: small;
        font-weight: 400;
        margin-left: 0.5mm;
        margin-right: 0.5mm;
      }
      .float{
        position:fixed;
        width:60px;
        height:60px;
        bottom:40px;
        right:40px;
        background-color:#0C9;
        color:#FFF;
        border-radius:50px;
        text-align:center;
        box-shadow: 2px 2px 3px #999;
        text-decoration: none;
        cursor: pointer;
      }
      @media print{
        #save{
          display: none;
        }
      }
    </style>
</head>
    <body class="A4" id='body'>        
      <section class="sheet padding-10mm">
        <div class="row">
          <div class="col-12">
            <center><p>Original For Recipient/Duplicate For Transporter/Triplicate</p></center>
            <h1 style="padding-left: 10mm; margin: 5mm 0;">FALCON ENGINEERING INDUSTRIES</h1>
            <div class="row">
              <div class="col-6" style="text-align: justify; box-shadow: none; padding-left: 10mm;">
                <p>(OFF) : P-79, BEE HIVE GARDEN
                  KOLKATA  - 700 056.</p>
                <p>(FACT) :  3,  AMBIKA MUKHERJEE ROAD
                  KOLKATA  - 700 056.</p>
                <p>Phone :  (033) 2544 4219</p>
                <p>E-Mail : feindustries097@gmail.com</p>
              </div>
              <div class="col-6" style="text-align: justify; box-shadow: none; padding-left: 10mm;">
                <p>GSTIN No. : 19AAAFF9690HIZO</p>
                <p>PAN No. : AAAFF9690H</p>
                <p>SAC Code : 998898</p>
                <p>Vendor Code : <span id="pCode"></span></p>
              </div>
            </div>
          </div>
        </div>

        <center><h3 style="margin: 1mm 0;">Delivery Challan</h3></center>

        <div class="row">
          <div class="col-6" style="text-align: justify; height: 30mm; padding-left: 2mm; font-size: small;">
            <h3 style="display: inline; vertical-align: top;">Customer: </h3>
            <h3 style="display: inline; vertical-align: top; padding: 0 2mm;">GSTIN: <span id="pGST"></h3>
            <p style="margin-top: 2mm;"><span id="pADD1"></span></p>
            <p><span id="pTo"></span></p>
            <p><span id="pADD2"></span></p>
            <p><span id="pADD3"></span></p>
          </div>

          <div class="col-6" style="text-align: justify; height: 30mm; padding-left: 2mm;">
            <p>Challan No. : <span id="chalanOutID"></span> </p>
            <p>Date : <span id="chalanOutDate"></span> </p>
            <p>IGP No. : </p>
            <p>Date : </p>
            <p>Order No. : <span id="orderNo"></span></p>
            <p>Date : <span id="orderDate"></span></p>
          </div>
        </div>
         
        <div class="row">
          <div class="col-6" style="text-align: justify; height: 25mm; padding-left: 2mm;">
              <p>ANXII No. : <span id="anx2"></span></p>
              <div id="chalanMaster" style="font-size:small; margin-top: 2mm;">

              </div>
          </div>

          <div class="col-6" style="text-align: justify; height: 25mm; padding: 2mm;">
            <p>Packing : <span id="packing"></span> </p>
            <p>Through : <span id="through"></span> </p>
            <p>R.R. No. : <span id="rrNo"></span> </p>
            <p>L.R. No. : <span id="lrNo"></span> </p>
          </div>
        </div>
        
        <div id="Table_1">

        <div class="row">
          <div class="col-2"><p style="text-align: center; padding: 1mm 0;">Plating</p></div>
          <div class="col-5"><p style="text-align: center; padding: 1mm 0;">Description And Code No.</p></div>
          <div class="col-1"><p style="text-align: center; padding: 1mm 0;">Unit</p></div>
          <div class="col-1Half"><p style="text-align: center; padding: 1mm 0;">Quantity</p></div>
          <div class="col-1"><p style="text-align: center; padding: 1mm 0;">Rate</p></div>
          <div class="col-1Half"><p style="text-align: center; padding: 1mm 0;">Amount</p></div>
        </div>

        <div class="row">
          <div class="col-2 firstPage">
            
          </div>

          <div class="col-5 firstPage" >
            <div  id="TotalValues" class="row" style="margin-right: 2mm; text-align: right; height: 25mm;">
              <p>Add CGST @ <span id="cgstPer" style="margin-left:5mm;"></span> % <span id="cgstVal" style="margin-left: 2mm;">CGSTValue</span></p>
              <p>Add SGST @ <span id="sgstPer" style="margin-left:5mm;"></span> % <span id="sgstVal" style="margin-left: 2mm; border-bottom: .35mm solid black;">SGSTValue</span></p>
              <p>Total GST: <span style="margin-left: 7mm;" id="totalGST">TotalGST</span></p>
              <p>Round Off <span id='typeR'></span> </p>
            </div>
          </div>

          <div class="col-1 firstPage" >
            
          </div>

          <div class="col-1Half firstPage" >
      
          </div>

          <div class="col-1 firstPage" >
            
          </div>

          <div class="col-1Half firstPage" >
            <div  id="totalBoxGST" class="row" style="padding-right: 2mm; text-align: right; height: 25mm;">
              <p>&nbsp;</p>
              <p>&nbsp;</p>
              <p id="totalGST2"></p>
              <p id="roundOff"></p>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <div class="row">
              <div class="col-1" style="box-shadow: none; margin-left: 1mm;"><p>Rupees: </p></div>
              <div class="col-7" style="box-shadow: none;" ><span id="amountWords"></span> Only</div>
              <div class="col-1Half" style="box-shadow: none;"><p>Total Value</p></div>
              <div class="col-2" style="text-align: right;box-shadow: none; margin-left: 5mm;"><p id="billRoundOff"></p></div>
            </div>
          </div>
        </div>

        <div class="row" style="height: 20mm;">
          <div class="col-12">
            <div class="row">
              <div class="col-8" style="box-shadow: none;">&nbsp;</div>
              <div class="col-4" style="box-shadow: none; text-align: center;">
                <p>For E & O.E.</p>
                <p style="margin-top: 8mm;">For <strong>G.D. Electroplating Works</strong></p>
              </div>
            </div>
          </div>
        </div>

        <footer style="text-align: center;"></footer>

        
      </div>
      </section> 
      
      <a id="save" class="float">
        <img src="../imgs/save.png" height="24" style="margin-top:18px;">
      </a>
    <script src="../currency.js"></script>
    <script>
        let totalValues=document.getElementById('TotalValues').cloneNode(true);
        let totalGST=document.getElementById('totalBoxGST').cloneNode(true);
        document.getElementById('TotalValues').remove();
        document.getElementById('totalBoxGST').remove();
        let table=document.getElementById('Table_1');
        let tableClone=table.cloneNode(true);
        let pageNo=1;
        let limit=0;
        let saveButton=document.getElementById('save');
        let length=0;


        function init(data){
          console.log(data);
          length=data.chalanOutDetails.length;
          addPartyCreds(data.partyMaster);
          addChalanInCreds(data.chalanInMaster);
          addChalanOutCreds(data.chalanOutMasterData);
          addRowToTable(data.chalanOutDetails);
          caculateOffset();
          caculateOffset_2();
          GSTPart(data.chalanOutMasterData);
        }
        saveButton.addEventListener('click',()=>{
          window.print();
        });

        function properDate(date){
            if(date != null)
                return new Date(date).toLocaleDateString('en-GB');
            return '';
        }
        function addPartyCreds(partyInfo){
          addText('pCode',partyInfo.partyCode);
          addText('pTo',partyInfo.partyName);
          addText('pGST',partyInfo.gstinNo);
          addText('pADD1',partyInfo.addressee);
          addText('pADD2',partyInfo.partyAddress1);
          addText('pADD3',partyInfo.partyAddress2);
        }
        function addChalanInCreds(chalanIn){
          addText('orderNo', chalanIn.orderNo);
          addText('orderDate',properDate(chalanIn.orderDate));
          addText('anx2',chalanIn.ANX2);
          let chalanMaster=document.getElementById('chalanMaster');
          if(chalanIn.issueNo != null)
            if(chalanIn.issueNo.length != 0)
              addParaToDiv(chalanMaster,"Issue Voucher No. : <span class='small-p'>" +chalanIn.issueNo+"</span> Date: <span class='small-p'>"+properDate(chalanIn.issueDate)+"</span>");
          if(chalanIn.iNoteNo != null)
              if(chalanIn.iNoteNo.length != 0)
                addParaToDiv(chalanMaster,"I/Note No. : <span class='small-p'>" +chalanIn.iNoteNo+"</span> Date: <span class='small-p'>"+properDate(chalanIn.iNoteDate)+"</span>");
          if(chalanIn.gpNo != null )
              if(chalanIn.gpNo.length != 0)
                addParaToDiv(chalanMaster,"Gate Pass No. : <span class='small-p'>" +chalanIn.gpNo+"</span> Date: <span class='small-p'>"+properDate(chalanIn.gpDate) + "</span>");
        }
        function addChalanOutCreds(chalanOut){
          addText('chalanOutID',chalanOut.chalanOutID);
          addText('chalanOutDate',properDate(chalanOut.outDate));
          addText('packing',chalanOut.packing);
          addText('through',chalanOut.through);
          addText('rrNo',chalanOut.rrNo);
          addText('lrNo',chalanOut.lrNo);
        }
        function GSTPart(chalanOut){
          document.getElementById('cgstPer').innerText=Number(chalanOut.cgstRate).toFixed(2);
          document.getElementById('cgstVal').innerText=Number(chalanOut.cgstValue).toFixed(2);
          document.getElementById('sgstPer').innerText=Number(chalanOut.sgstRate).toFixed(2);
          document.getElementById('sgstVal').innerText=Number(chalanOut.sgstValue).toFixed(2);
          document.getElementById('totalGST').innerText=Number(chalanOut.totalGST).toFixed(2);
          let diff=Number(chalanOut.billRoundOff)-Number(chalanOut.billValue);
          if(diff>0)
            document.getElementById('typeR').innerText='More';
          else if(diff<0)
            document.getElementById('typeR').innerText='Less';
          document.getElementById('totalGST2').innerText=Number(chalanOut.totalGST).toFixed(2);
          document.getElementById('roundOff').innerText=Number(diff).toFixed(2);
          document.getElementById('amountWords').innerText=fprice_in_words(Number(chalanOut.billRoundOff));
          document.getElementById('billRoundOff').innerText=Number(chalanOut.billRoundOff).toFixed(2);
        }
        function addParaToDiv(div,paraContent){
          if(paraContent != null)
            div.innerHTML+=createPara(paraContent);
        }
        function createPara(paraContent){
          return '<p>'+paraContent+'</p>'
        }
        function addText(id,obj){
          if(obj != null)
            document.getElementById(id).innerText=obj;
        }
        function addRowToTable(chalanOutDetails){
          checkLimit();
          for(let i=1;i<=length;i++){
            let chalanOutDetail=chalanOutDetails[i-1];
            addPlating(chalanOutDetail.platingType);
            addDescription(chalanOutDetail.desc1,chalanOutDetail.desc2,chalanOutDetail.itemCode);
            addUnit(chalanOutDetail.unit);
            addQuantity(chalanOutDetail.qty);
            addRate(chalanOutDetail.rate);
            addAmount(chalanOutDetail.amount);
            //Adding new Pages
            if(i==limit && limit<length)
              addNewPage();
          }
        }
        function addPlating(plating){
          let data=(plating == null || plating.length == 0)?'&nbsp;':plating;
          let newData="<p class='content'>"+data+"</p>"
          table.children[1].children[0].innerHTML+=newData;
        }
        function addDescription(desc1,desc2,itemCode){
          let data=(desc1 == null || desc1.length == 0)?'&nbsp;':desc1;
          let data2=(desc2 == null || desc2.length == 0)?'&nbsp;':desc2;
          let data3=(itemCode == null || itemCode.length == 0)?'&nbsp;':'ITEM CODE : '+itemCode;
          let div=document.createElement('div');
          div.classList.add('content');
          addParaToDiv(div,data);
          addParaToDiv(div,data2);
          addParaToDiv(div,data3);
          table.children[1].children[1].appendChild(div);
        }
        function addUnit(unit){
          let data=(unit == null || unit.length == 0)?'&nbsp;':unit;
          let newData="<p class='content'>"+data+"</p>"
          table.children[1].children[2].innerHTML+=newData;
        }
        function addQuantity(qty){
          let data=(qty == null || qty.length == 0)?'&nbsp;':Number(qty).toFixed(3);
          let newData="<p class='content'>"+data+"</p>"
          table.children[1].children[3].innerHTML+=newData;
        }
        function addRate(rate){
          let data=(rate == null || rate.length == 0)?'&nbsp;':Number(rate).toFixed(2);
          let newData="<p class='content'>"+data+"</p>"
          table.children[1].children[4].innerHTML+=newData;
        }
        function addAmount(amount){
          let data=(amount == null || amount.length == 0)?'&nbsp;':Number(amount).toFixed(2);
          let newData="<p class='content'>"+data+"</p>"
          table.children[1].children[5].innerHTML+=newData;
        }
        function addNewPage(){
          table.children[2].firstElementChild.innerHTML='&nbsp;'
          if(pageNo==1)
            table.children[4].innerText=pageNo;
          pageNo++;
          checkLimit();
          tableClone.id='Table_'+pageNo;
          let newPg=document.createElement('section');
          newPg.classList.add('sheet')
          newPg.classList.add('padding-10mm');
          newPg.append(tableClone);
          document.body.append(newPg);
          tableClone=document.getElementById('Table_'+pageNo).cloneNode(true);
          let newTb=[...document.getElementById('Table_'+pageNo).children[1].children];
          newTb.forEach(element => {
            element.classList.remove('firstPage');
            element.classList.add('secondPage');
          });
          table=document.getElementById('Table_'+pageNo);
          table.children[4].innerText=pageNo;
        }
        function checkLimit(){
          let pageLimit = pageNo==1?5:10;
          if(length <= limit+pageLimit)
            limit+=pageLimit
          else
            if(length == limit + pageLimit + 1)
              limit+=pageLimit
            else
              limit+=pageLimit+1;
            console.log(limit);
        }
        function caculateOffset(){
          totalValues.style.position='relative';
          totalValues.style.top=(((limit-length)*22)+((pageNo==1)?5:0)).toString()+'mm';
          table.children[1].children[1].appendChild(totalValues);
        } 
        function caculateOffset_2(){
          totalGST.style.position='relative';
          totalGST.style.top=(((limit-length)*22)+((pageNo==1)?5:0)).toString()+'mm';
          table.children[1].children[5].appendChild(totalGST);
        }       
        init(JSON.parse(window.localStorage.getItem('printData'))); 
    </script>
</body>
</html>